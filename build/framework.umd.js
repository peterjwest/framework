(function(p,d){typeof exports=="object"&&typeof module<"u"?d(exports):typeof define=="function"&&define.amd?define(["exports"],d):(p=typeof globalThis<"u"?globalThis:p||self,d(p.NAME={}))})(this,function(p){"use strict";var J=Object.defineProperty;var K=(p,d,g)=>d in p?J(p,d,{enumerable:!0,configurable:!0,writable:!0,value:g}):p[d]=g;var l=(p,d,g)=>K(p,typeof d!="symbol"?d+"":d,g);class d{constructor(e){l(this,"tagName");l(this,"children",[]);this.tagName=e}appendChild(e){this.children.push(e)}insertBefore(e,n){const r=this.children.findIndex(a=>a===n);if(r===-1)throw new Error("Child not found");this.children.splice(r,0,e)}}const g={createElement:t=>new d(t),createTextNode:t=>({textContent:t})},F=new Set(["string","number","bigint","boolean","null","undefined"]);function j(t){return F.has(typeof t)}function w(t){return t.children}function A(t){return t===void 0?[]:Array.isArray(t)?t:[t]}function o(t,e){if(typeof t=="string"){const r=e||{};return{type:t,props:{...r,children:A(r.children)}}}const n=e||{};return{type:t,props:{...n,children:A(n.children)}}}class s{constructor(e){l(this,"value");l(this,"dependents",new Set);l(this,"deriveListeners",[]);l(this,"updateListeners",[]);this.value=e}static extract(e){return e.value}static computed(e,n){const r=new k(()=>n(...e.map(a=>a.value)));for(const a of e)a.dependents.add(r);return r}computed(e){const n=s.computed([this],e);for(const r of this.deriveListeners)r(this,n);return n}addUpdateListener(e){this.updateListeners.push(e),e(this.value)}addDeriveListener(e){this.deriveListeners.push(e)}get(e){return this.computed(n=>n[e])}update(e){this.value=e;for(const n of this.dependents)n.recompute();for(const n of this.updateListeners)n(this.value)}debounce(e){return this}}class k extends s{constructor(n){super(n());l(this,"compute");this.compute=n}recompute(){this.value=this.compute(),this.update(this.value)}}class E extends s{}function N(t){return{type:N,props:{...t,children:[]}}}function S(t){return{type:S,props:{...t,children:[]}}}function M(t,e=[]){e=e.concat(t);for(const n of t)e=M(Array.from(n.dependents),e);return e}class H{constructor(e,n){l(this,"children",new Set);l(this,"derived",new Map);l(this,"addValue",(e,n)=>{this.derived.set(e,n);for(const r of this.children)r.derived.set(e,n)});for(const r of e)r.addDeriveListener(this.addValue);n&&n.children.add(this)}extract(){const e=this.derived;return this.derived=new Map,e}}function T(t,e,n){const r=s.extract(e);r>=t.children.length?t.appendChild(n):t.insertBefore(n,t.children[r])}function m(t,e,n=new s(0),r){if(j(t)){console.log("primitive",s.extract(n),e.children.length);const c=g.createTextNode(t?String(t):"");return T(e,n,c),[void 0,n.computed(i=>i+1)]}if(t instanceof s){const c=g.createTextNode("");return t.addUpdateListener(i=>{c.textContent=i}),console.log("Value",s.extract(n),e.children.length),T(e,n,c),[void 0,n.computed(i=>i+1)]}if(t.type===S)return[void 0,n];if(t.type===w){const c=[];let i=n;for(const u of t.props.children){const[h,x]=m(u,e,i,r);h&&c.push(h),i=x}return[()=>{for(const u of c)u()},i]}if(typeof t.type=="string"){const c=g.createElement(t.type);console.log("html",t.type,s.extract(n),e.children.length),T(e,n,c);const i=[];let u=new s(0);for(const h of t.props.children){const[x,L]=m(h,c,u,r);u=L,x&&i.push(x)}return[()=>{for(const h of i)h()},n.computed(h=>h+1)]}if(t.type===N){const c=t,i=new s(0);let u,h;return c.props.if.addUpdateListener(x=>{if(h!==!!x){const L=x?c.props.then:c.props.else;u&&(u(),u=void 0);const U=new s(0);if(L){const G={type:L,props:{children:[]}};let D;[u,D]=m(G,e,n,r),U.update(s.extract(D))}else U.update(s.extract(n));h=!!x}}),[()=>{u&&u()},i]}let a=[];const v=c=>{const i=new E(c);return a.push(i),i},C=t.type(t.props,v),f=r?r.extract():new Map,y=M(Array.from(f.values()).concat(a)),b=new H(y,r),[q,z]=m(C,e,n,b);return[q,z]}const I={};function O({children:t}){return o("section",{children:t})}function R({query:t},e){const n=e("x"),a=t.computed(v=>v.toUpperCase()).computed(v=>v+v);return o(w,{children:[o("h1",{children:n}),o("p",{children:a})]})}function V({fullName:t},e){const n=e("hi"),r=n.debounce(100).computed(f=>({success:!0,data:Array(f.length).fill({name:f})})),a=t.computed(f=>f.split(" ")[0]),v=s.computed([n,r],(f,y)=>y.data.length/f.length),C=r.get("data").get("length");return o("article",{children:[o(O,{children:o("h1",{children:["Hello ",a," how are you?"]})}),o(w,{children:o("input",{class:"search-box",onChange:()=>n})}),o(R,{query:n}),o(N,{if:C,then:()=>o(w,{children:[o("div",{children:["Found ",C," results for ",n,"Efficiency: ",v]}),o(S,{data:r.get("data"),element:f=>{const y=t.computed(b=>b.toLowerCase());return o("div",{class:"item",children:[f.get("name")," owned by ",y]})}})]}),else:()=>o("div",{children:"Loading!"})})]})}const B=g.createElement("div");m(o(V,{fullName:new s("x")}),B),console.log(I.inspect(B,{depth:1/0})),p.Component=V,Object.defineProperty(p,Symbol.toStringTag,{value:"Module"})});
